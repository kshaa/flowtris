!function(t){function i(n){if(e[n])return e[n].exports;var s=e[n]={i:n,l:!1,exports:{}};return t[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}var e={};i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,i){return Object.prototype.hasOwnProperty.call(t,i)},i.p="",i(i.s=1)}([function(t,i,e){"use strict";var n;void 0!==(n=function(){return function(){this.clockwise=function(t){var i=JSON.parse(JSON.stringify(t)),e=this._clockwiseTetromino(i.tetramino);return i.tetramino=e,i},this.anticlockwise=function(t){var i=JSON.parse(JSON.stringify(t)),e=this._anticlockwiseTetromino(i.tetramino);return i.tetramino=e,i},this._clockwiseTetromino=function(t){var i=this._transpose(t);return this._reverseRows(i)},this._anticlockwiseTetromino=function(t){var i=this._reverseRows(t);return this._transpose(i)},this._transpose=function(t){for(var i=JSON.parse(JSON.stringify(t)),e=0;e<i.length;e++)for(var n=0;n<e;n++){var s=i[e][n];i[e][n]=i[n][e],i[n][e]=s}return i},this._reverseRows=function(t){return JSON.parse(JSON.stringify(t)).map(function(t){return t.reverse()})}}}.call(i,e,i,t))&&(t.exports=n)},function(t,i,e){"use strict";var n;void 0!==(n=function(t){var i=e(2),n=e(3),s=e(4),r=e(6);return function(t){this.hook=new n,this._game=new i,this._randomize=new s,this._mechanics=new r(this._game,this._randomize),this.seed=this._randomize.seed,this.field=this._mechanics.field,this._main=function(){var t=this,i=this._logTime();this.hook._runBefores(this,i),this._game.settings.playing&&!this._game.settings.delayed&&(this._mechanics.spawn(),this._mechanics.move(),this._mechanics.flushMoves(),this._mechanics.lock(function(){t._mechanics.storePiece.bind(t._mechanics)(),t._mechanics.removeFilled.bind(t._mechanics)()})),this.hook._runAfters(this,i),setTimeout(function(){window.requestAnimationFrame(t._main.bind(t))},1e3/60-i)},this._logTime=function(){if(void 0===this._game.settings.startedAt){var t=performance.now();this._game.settings.startedAt=t}else var i=this._game.frame.lastTime,t=i;var e=performance.now();return this._game.frame.lastTime=e,e-t},this.move=function(t){this._game.frame.moves.push(t)},this.pause=function(){this._game.settings.playing=!1},this.unpause=function(){this._game.settings.playing=!0},this.togglePause=function(){console.log("toggle"),this._game.settings.playing=!this._game.settings.playing},this.delay=function(){this._game.settings.delayed=!0},this.undelay=function(){this._game.settings.delayed=!1},this.toggleDelay=function(){this._game.settings.delayed=!this._game.settings.delayed},this.start=function(i){void 0!==this._game.settings.startedAt&&(this._game=new Gamestate,this._randomize=new Randomize(t),this._mechanics=new Mechanics(this._game,this._randomize)),this._game.settings.frameId=window.requestAnimationFrame(this._main.bind(this)),i=void 0!==i,this._game.settings.playing=!i},this.stop=function(){var t=this._game.settings.frameId;window.cancelAnimationFrame(t),this.start(!0)},this.restart=function(){this.stop(),this.start()}}}.call(i,e,i,t))&&(t.exports=n)},function(t,e,n){"use strict";var s;void 0!==(s=function(){return function(){for(this.settings={gravity:1e3,height:24,width:10,droppedAt:0,startedAt:void 0,playing:!1,delayed:!1,delayTime:300,frameId:void 0,locking:!1,lockingSince:0,lockTime:500},this.frame={time:0,piece:{active:!1,key:void 0,x:void 0,y:void 0,rotation:void 0,tetramino:void 0},moves:new Array,field:void 0},this.frame.field=new Array(this.settings.height),i=0;i<this.settings.height;i++)field[i]=new Array(this.settings.width).fill(0)}}.call(e,n,e,t))&&(t.exports=s)},function(t,e,n){"use strict";var s;void 0!==(s=function(){return function(){this.before=function(t){return this._befores.push(t),this._befores.length-1},this._runBefores=function(t,e){for(i=0;i<this._befores.length;i++)this._befores[i](t,e)},this._befores=new Array,this.after=function(t){return this._afters.push(t),this._afters.length-1},this._runAfters=function(t,e){for(i=0;i<this._afters.length;i++)this._afters[i](t,e)},this._afters=new Array}}.call(e,n,e,t))&&(t.exports=s)},function(t,i,e){"use strict";var n;void 0!==(n=function(t){var i=e(5);return function(t){this._seed=void 0===t?Math.round(Math.random()*Math.pow(10,17)):t,this._id=0,this._keys=new Array,this._tetrominos=i,this._random=function(){var t=1e4*Math.sin(this._seed++);return t-Math.floor(t)},this._populate=function(){for(var t,i,e=Object.keys(this._tetrominos),n=e.length;0!==n;)i=Math.floor(Math.random()*n),n-=1,t=e[n],e[n]=e[i],e[i]=t;this._keys=this._keys.concat(e)},this._stock=function(){(this._id+1)%7==1&&this._populate()},this._getTetrominoFromKey=function(t){var i=this._tetrominos[t],e=JSON.parse(JSON.stringify(i));return e.key=t,e.active=!1,e},this._getTetrominoLast=function(){var t=this._keys[this._id],i=this._getTetrominoFromKey(t);return this._id++,i},this.seed=function(t){if(0==arguments.length)return this._seed;this._seed=t},this.tetromino=function(){return this._stock(),this._getTetrominoLast()}}}.call(i,e,i,t))&&(t.exports=n)},function(t,i,e){"use strict";t.exports={i:{tetramino:[[0,0,0,0,0],[0,0,0,0,0],[0,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0]],x:2,y:0,rotation:0},j:{tetramino:[[1,0,0],[1,1,1],[0,0,0]],x:3,y:1,rotation:0},l:{tetramino:[[0,0,1],[1,1,1],[0,0,0]],x:3,y:1,rotation:0},o:{tetramino:[[0,1,1],[0,1,1],[0,0,0]],x:3,y:1,rotation:0},s:{tetramino:[[0,1,1],[1,1,0],[0,0,0]],x:3,y:1,rotation:0},z:{tetramino:[[1,1,0],[0,1,1],[0,0,0]],x:3,y:1,rotation:0},t:{tetramino:[[0,1,0],[1,1,1],[0,0,0]],x:3,y:1,rotation:0}}},function(t,e,n){"use strict";var s;void 0!==(s=function(t){var e=n(7);return function(t,n){this._move=new e(t),this.move=this._move.move.bind(this._move),this.field=function(){var e=JSON.parse(JSON.stringify(t.frame.field)),n=t.frame.piece,s=n.tetramino;if(n.active)for(i=0;i<s.length;i++)for(j=0;j<s[0].length;j++)if(0!=s[i][j]){var r=s[i][j];console.log(e,n,i,j),e[n.y+i][n.x+j]=r?n.key:"0"}return e},this.spawn=function(){t.frame.piece.active||(t.frame.piece=n.tetromino(),t.frame.piece.active=!0)},this.flushMoves=function(){t.frame.moves=new Array},this.storePiece=function(){t.frame.field=this.field(),t.frame.piece.active=!1},this.removeFilled=function(){var e=t.frame.field,n=e.map(function(t){return-1==t.findIndex(function(t){return 0==t})});for(i=0;i<n.length;i++){var s=t.frame.field;if(n[i]){var r=new Array(t.settings.width);r.fill(0),r=[r],t.frame.field=r.concat(s.splice(0,i).concat(s.splice(i+1,s.length-i-1))),console.log(i,s,r,n)}}},this.lock=function(i){var e=t.frame.piece;if(0==this._move.minDistance(e)){var n=t.settings;if(0==n.locking)n.locking=!0,n.lockingSince=performance.now();else{var s=n.lockingSince;performance.now()-s>n.lockTime&&(n.locking=!1,i())}}}}}.call(e,n,e,t))&&(t.exports=s)},function(t,e,n){"use strict";var s,r;s=[n,n(8),n(0),n(11)],void 0!==(r=function(t,e,n,s){return function(t){this._srs=new e,this._rotate=new n,this._validator=new s(t),this._intentional=function(){var i=!0,e=!1,n=void 0;try{for(var s,r=t.frame.moves[Symbol.iterator]();!(i=(s=r.next()).done);i=!0){var o=s.value;this._set(o)}}catch(t){e=!0,n=t}finally{try{!i&&r.return&&r.return()}finally{if(e)throw n}}},this._forced=function(){var i=t.settings.droppedAt;performance.now()-i>t.settings.gravity&&(t.settings.droppedAt=performance.now(),this._set("down"))},this.move=function(t){this._intentional(),this._forced()},this._set=function(i){var e=this._check(i);if(void 0!==e){switch(i){case"down":t.settings.droppedAt=performance.now();break;case"drop":t.settings.lockingSince=0,t.settings.locking=!0}for(var n in e)t.frame.piece[n]=e[n]}},this._bottoms=function(t){var e=JSON.parse(JSON.stringify(t.tetramino)),n=new Array,s=this._rotate._clockwiseTetromino(e);for(i=0;i<e.length;i++)d=s[i].findIndex(function(t){return 0!=t}),-1==d?n[i]=-1:n[i]=e.length-d-1;return n},this._getColumn=function(t,i){var e=new Array;for(j=0;j<t.length;j++)e[j]=t[j][i];return e},this._distances=function(e){var n=JSON.parse(JSON.stringify(t.frame.field)),s=this._bottoms(e),r=new Array;for(i=0;i<s.length;i++)if(-1!=s[i]){var o=this._getColumn(n,e.x+i),a=s[i]+e.y,c=o.splice(a+1,o.length-a-1),h=c.findIndex(function(t){return 0!=t});r[i]=-1==h?c.length:h}else r[i]=n.length+1;return r},this.minDistance=function(t){var i=this._distances(t);return Math.min.apply(Math,i)},this._drop=function(t){return t.y+=this.minDistance(t),t},this._check=function(i){var e=t.frame.piece,n=new Array,s=void 0;switch(i.toLowerCase()){case"cw":n=this._srs.rotateClockwise(e),console.log(n);break;case"ccw":n=this._srs.rotateAnticlockwise(e);break;case"left":s=JSON.parse(JSON.stringify(e)),s.x-=1,n.push(s);break;case"right":s=JSON.parse(JSON.stringify(e)),s.x+=1,n.push(s);break;case"down":s=JSON.parse(JSON.stringify(e)),s.y+=1,n.push(s);break;case"drop":s=JSON.parse(JSON.stringify(e)),n.push(this._drop(s));break;default:console.log('Unknown movement key in Mechanics: "'+i.toLowerCase()+'"')}return this._validator.check(n)}}}.apply(e,s))&&(t.exports=r)},function(t,i,e){"use strict";var n,s;n=[e(0),e(9)],void 0!==(s=function(t,i){return function(){this.rotateClockwise=function(t){var i=JSON.parse(JSON.stringify(t)),e=this._rotate.clockwise(i),n=this._offset.clockwise(i),s=new Array,r=!0,o=!1,a=void 0;try{for(var c,h=n[Symbol.iterator]();!(r=(c=h.next()).done);r=!0){var f=c.value,u=JSON.parse(JSON.stringify(e));console.log("oldx: ",u.x),console.log("offset: ",f[0]),u.x+=f[0],u.y-=f[1],console.log("newx: ",u.x),u.rotation=this._offset.clockwiseKey(u.rotation.toString()),s.push(u)}}catch(t){o=!0,a=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw a}}return s},this.rotateAnticlockwise=function(t){var i=JSON.parse(JSON.stringify(t)),e=this._rotate.anticlockwise(i),n=this._offset.anticlockwise(i),s=new Array,r=!0,o=!1,a=void 0;try{for(var c,h=n[Symbol.iterator]();!(r=(c=h.next()).done);r=!0){var f=c.value,u=JSON.parse(JSON.stringify(e));u.x+=f[0],u.y-=f[1],u.rotation=this._offset.anticlockwiseKey(u.rotation.toString()),s.push(u)}}catch(t){o=!0,a=t}finally{try{!r&&h.return&&h.return()}finally{if(o)throw a}}return s},this._rotate=new t,this._offset=new i}}.apply(i,n))&&(t.exports=s)},function(t,e,n){"use strict";var s,r;s=[n(10)],void 0!==(r=function(t){return function(){this.clockwise=function(t){var i=t.rotation.toString(),e=this.clockwiseKey(i);return this._offsets(t.key,i,e)},this.clockwiseKey=function(t){var i=this._rotations;return i[(i.indexOf(t)+1)%4]},this.anticlockwise=function(t){var i=t.rotation.toString(),e=this.anticlockwiseKey(i);return this._offsets(t.key,i,e)},this.anticlockwiseKey=function(t){var i=this._rotations;return i[(i.indexOf(t)+3)%4]},this._offsets=function(t,e,n){var s=this._wallkicks,r=s[t][e],o=s[t][n],a=new Array;for(i=0;i<r.length;i++){var c=r[i][0]-o[i][0],h=r[i][1]-o[i][1];a[i]=[c,h]}return console.log(a),a},this._rotations=["0","r","2","l"],this._wallkicks=new t}}.apply(e,s))&&(t.exports=r)},function(t,i,e){"use strict";var n;void 0!==(n=function(){return function(){this.j={0:[[0,0],[0,0],[0,0],[0,0],[0,0]],r:[[0,0],[1,0],[1,-1],[0,2],[1,2]],2:[[0,0],[0,0],[0,0],[0,0],[0,0]],l:[[0,0],[-1,0],[-1,-1],[0,2],[-1,2]]},this.i={0:[[0,0],[-1,0],[2,0],[-1,0],[2,0]],r:[[-1,0],[0,0],[0,0],[0,1],[0,-2]],2:[[-1,1],[1,1],[-2,1],[1,0],[-2,0]],l:[[0,1],[0,1],[0,1],[0,-1],[0,2]]},this.o={0:[[0,0]],r:[[0,-1]],2:[[-1,-1]],l:[[-1,0]]},this.l=this.j,this.s=this.j,this.t=this.j,this.z=this.j}}.call(i,e,i,t))&&(t.exports=n)},function(t,e,n){"use strict";var s;void 0!==(s=function(){return function(t){this.check=function(t){return t.find(this.fits.bind(this))},this.fits=function(t){return!!this._inbounds(t)&&this._fits(t)},this._inbounds=function(t){var e=!0;for(i=0;i<t.tetramino.length;i++)for(j=0;j<t.tetramino[0].length;j++)if(0!=t.tetramino[i][j]){var n=this._inboundsPixel(t.x+j,t.y+i);e=e&&n}return e},this._inboundsPixel=function(i,e){var n=t.frame.field,s=i>=0&&e>=0,r=i<n[0].length,o=e<n.length;return s&&r&&o},this._fits=function(e){var n=t.frame.field,s=e.x,r=e.y,o=e.tetramino;for(i=0;i<o.length;i++)for(j=0;j<o[0].length;j++)if(0!=o[i][j]){var a=n[i+r][j+s],c=o[i][j];if(0!=a&&0!=c)return!1}return!0}}}.call(e,n,e,t))&&(t.exports=s)}]);